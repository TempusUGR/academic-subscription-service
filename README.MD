# TempusUGR - Academic Subscription Service

Este repositorio contiene el c√≥digo fuente del `academic-subscription-service`, un microservicio clave dentro de la arquitectura del proyecto **TempusUGR**.

Su principal responsabilidad es gestionar toda la informaci√≥n acad√©mica personalizada del usuario. Esto incluye las suscripciones a asignaturas y grupos, la creaci√≥n de eventos personalizados (como tutor√≠as o charlas) y la generaci√≥n del calendario final que el usuario visualiza y sincroniza.

---

## ‚ú® Funcionalidades Principales

* **Gesti√≥n de Suscripciones:** Permite a los usuarios suscribirse y darse de baja de grupos espec√≠ficos de asignaturas. Tambi√©n ofrece la posibilidad de realizar suscripciones masivas (por ejemplo, todas las asignaturas que imparte un profesor).
* **Generaci√≥n de Calendario Personalizado:** Agrega la informaci√≥n de las clases oficiales (obtenidas del `schedule-consumer-service`) con los eventos personalizados creados por el usuario para generar una vista de calendario completa.
* **Creaci√≥n de Eventos:** Ofrece endpoints para que los profesores y administradores puedan crear eventos adicionales, ya sea a nivel de grupo de asignatura o a nivel de facultad.
* **Exportaci√≥n y Sincronizaci√≥n:** Genera archivos en formato **iCalendar (.ics)** y proporciona una **URL de sincronizaci√≥n** segura y √∫nica para que los usuarios puedan integrar su horario con calendarios externos como Google Calendar, Outlook, etc.
* **Notificaciones:** Publica mensajes en **RabbitMQ** cuando se crean nuevos eventos, permitiendo que otros servicios (como el `mail-service`) notifiquen a los usuarios afectados.

---

## üõ†Ô∏è Pila Tecnol√≥gica

* **Lenguaje/Framework:** Java 21, Spring Boot 3.4.4
* **Base de Datos:** **MongoDB**, elegido por su flexibilidad para almacenar documentos con estructuras variables como las suscripciones y los eventos.
* **Comunicaci√≥n As√≠ncrona:** **RabbitMQ** para la publicaci√≥n de eventos de notificaci√≥n.
* **Comunicaci√≥n S√≠ncrona:** API REST para interactuar con otros servicios.
* **Descubrimiento de Servicios:** Cliente de **Eureka** para el registro y descubrimiento en la red de microservicios.

---

## üèóÔ∏è Arquitectura e Interacciones

Este servicio es un componente central y se comunica con varios otros microservicios:

* **`schedule-consumer-service` (REST):** Le solicita la informaci√≥n de las clases oficiales (horarios, aulas, etc.) correspondientes a las suscripciones de un usuario.
* **`user-service` (REST):** Consulta informaci√≥n de los usuarios cuando es necesario para validar permisos o gestionar eventos.
* **`mail-service` (V√≠a RabbitMQ):** Publica eventos (ej. "evento creado") en una cola de RabbitMQ para que el servicio de correo env√≠e notificaciones de forma as√≠ncrona.
* **`eureka-service`:** Se registra en el servidor Eureka para ser descubierto por el `api-gateway` y otros servicios.

---

## üîå API Endpoints Principales

El servicio expone una serie de endpoints bajo el prefijo `/academic-subscription`.

| M√©todo | Ruta | Descripci√≥n |
| :--- | :--- | :--- |
| `POST` | `/subscription` | Suscribe al usuario a un grupo de una asignatura. |
| `POST` | `/subscription-batching` | Realiza una suscripci√≥n masiva a varios grupos. |
| `GET`| `/subscriptions` | Devuelve las suscripciones activas del usuario. |
| `DELETE` | `/subscription` | Elimina una suscripci√≥n espec√≠fica. |
| `GET` | `/entire-calendar`| Obtiene el calendario completo del usuario (clases + eventos). |
| `POST`| `/group-event` | Crea un evento a nivel de grupo de asignatura. |
| `POST`| `/faculty-event` | Crea un evento a nivel de facultad. |
| `DELETE` | `/group-event` | Elimina un evento de grupo por su ID. |
| `GET`| `/ics` | Genera y devuelve el calendario del usuario en formato `.ics`. |
| `GET`| `/sync-url` | Devuelve la URL p√∫blica para la sincronizaci√≥n del calendario. |

---

## üöÄ Puesta en Marcha Local

### **Prerrequisitos**

* Java 21 o superior.
* Maven 3.x.
* Una instancia de **MongoDB** en ejecuci√≥n.
* Una instancia de **RabbitMQ** en ejecuci√≥n.
* Un servidor **Eureka** (`eureka-service`) en ejecuci√≥n.

### **Configuraci√≥n**

Configura los siguientes par√°metros en el archivo `src/main/resources/application.properties`:

```properties
# MongoDB Configuration
spring.data.mongodb.uri=mongodb://<user>:<password>@<host>:<port>/<database_name>

# RabbitMQ Configuration
spring.rabbitmq.host=<rabbitmq_host>
spring.rabbitmq.port=5672
spring.rabbitmq.username=<user>
spring.rabbitmq.password=<password>

# Eureka Client Configuration
eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka

# Server Port
server.port=8083 # O el puerto deseado
